{% extends "base.html" %}

{% block content %}
    <div class="mb-4">
        <form method="get" action="." class="d-flex align-items-center">
            <label for="start_date" class="form-label me-2">с:</label>
            <input type="date" name="start_date" id="start_date" class="form-control w-25 me-2" value="{{ request.GET.start_date }}">
            <label for="end_date" class="form-label me-2">по:</label>
            <input type="date" name="end_date" id="end_date" class="form-control w-25 me-2" value="{{ request.GET.end_date }}">
            <input type="submit" value="Задать период" class="btn btn-info me-2">
            <a href="{% url 'dashboard' %}" class="btn btn-secondary">Сбросить</a>
        </form>
    </div>

    <canvas id="incomeChart" width="400" height="200"></canvas>
    <canvas id="expenseChart" width="400" height="200"></canvas>

    
    <script src="https://cdnjs.com/libraries/Chart.js"></script>

    
    <script>
        let incomeData = {{ income_data|safe }};
        let expenseData = {{ expense_data|safe }};

        let incomeLabels = incomeData.map(data => data.category__name);
        let incomeValues = incomeData.map(data => data.total);

        let expenseLabels = expenseData.map(data => data.category__name);
        let expenseValues = expenseData.map(data => data.total);

        let incomeChart = new Chart(document.getElementById('incomeChart').getContext('2d'), {
            type: 'bar',
            data: {
                labels: incomeLabels,
                datasets: [{
                    label: 'Income by Category',
                    data: incomeValues,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                }]
            }
        });

        let expenseChart = new Chart(document.getElementById('expenseChart').getContext('2d'), {
            type: 'bar',
            data: {
                labels: expenseLabels,
                datasets: [{
                    label: 'Expense by Category',
                    data: expenseValues,
                    backgroundColor: 'rgba(255, 99, 132, 0.2)',
                }]
            }
        });
    </script>
{% endblock %}